(()=>{"use strict";function s(s,t){return s<0?s%t+t:s%t}const t={b:"#0341AE",g:"#72CB3B",c:"#00FFFF",r:"#FF3213",o:"#FF971C",y:"#FFD500",v:"#800080",s:"#999999",bg:"#7F7F7F",bl:"#121212",w:"#FFFFFF",sc:"#8FBC8B"},e=180,i=260,n=class{_canvas=null;_height=0;_pixelSize=0;_width=0;_getContext(){return this._canvas.getContext("2d")}constructor(s){this._canvas=document.getElementById(s),window.addEventListener("resize",this.resize.bind(this)),this.resize()}clear(){this._getContext().clearRect(0,0,this._width,this._height)}dispose(){window.removeEventListener("resize",this.resize.bind(this))}drawGameObject(n){if(!n.isDrawable())return;const r=n.getSprite(),o=n.getPosition(),g=o.getX(),h=o.getY(),c=this._getContext();for(let o=0;o<n._height;o++)for(let a=0;a<n._width;a++){const n=r[o][a];if(" "===n)continue;const l=this._pixelSize*s(g+a,i),_=this._pixelSize*s(h+o,e);c.fillStyle=t[n],c.fillRect(l,_,this._pixelSize,this._pixelSize)}}drawLives(s,e=this._pixelSize){const[i,n]=s,r=this._getContext(),o=177*this._pixelSize,g=n.length,h=n[0].length;for(let s=0;s<i;s++)for(let i=0;i<g;i++)for(let g=0;g<h;g++){if(" "===n[i][g])continue;const c=(g+(h+2)*s)*e,a=o+i*e;r.fillStyle=t.sc,r.fillRect(c,a,e,e)}}drawScore(s,i,n){const r=this._getContext(),o=String("STAGE "+s),g=String("hi-score "+Math.max(i,n)),h=r.measureText(g),c=String(n+" PTS"),a=r.measureText(c);r.font=5*this._pixelSize+"px sans-serif",r.fillStyle=t.sc,r.fillText(o,10,28),r.fillText(g,this._width-h.width-10,28),r.fillText(c,this._width-a.width-10,e*this._pixelSize)}resize(){const s=window.innerHeight/e,t=window.innerWidth/i;this._pixelSize=parseInt(Math.min(s,t)),this._height=this._pixelSize*e,this._width=this._pixelSize*i;const n=this._getContext();n.canvas.width=this._width,n.canvas.height=this._height,this.clear()}},r=class{_score=0;constructor(s=0){this._score=s}addScore(s){this._score+=s}getScore(){return this._score}reset(s){this._score=s||0}},o=class{constructor(s,t){this._x=s,this._y=t}getX(){return this._x}getY(){return this._y}},g=class{_height=0;_frame=0;_frameChangeFrequency=40;_frameTick=0;_isDisposed=!1;_isInMotion=!0;_position=null;_sprites=null;_width=0;constructor(s,t){this._height=s[0].length,this._position=t||new o(0,0),this._sprites=s,this._width=s[0][0].length}dispose(){delete this._animationFrequency,delete this._animationTicks,delete this._blinkingSprite,delete this._nextSpriteIdx,delete this._position,delete this._sprites,this._isDisposed=!0}draw(s){s.drawGameObject(this)}move(s=0,t=0){if(this.isDisposed())return;const e=this._position.getX()+s,i=this._position.getY()+t;this._position=new o(e,i),this.nextAninmationFrame()}nextAninmationFrame(){this._frameTick=(this._frameTick+1)%this._frameChangeFrequency,0===this._frameTick&&(this._frame=(this._frame+1)%this._sprites.length)}getPosition(){return this._position}getSize(){return{height:this._height,width:this._width}}getSprite(){return this._sprites[this._frame]}isDisposed(){return this._isDisposed}isDrawable(){return!this._isDisposed}isInMotion(){return this._isInMotion}setBlinking(s){this._blinking=s}},h=[[[" ","o"," "],["o","o","o"],[" ","o"," "],[" ","o"," "]],[[" ","o"," "],[" ","o"," "],["o","o","o"],[" ","o"," "]]],c=class extends g{_dy=0;_enemyFriendly=!1;constructor(s,t,e,i){super(i||h,new o(s,t)),this._dy=e,this._frameChangeFrequency=10}colidesWith(s){return function(s,t){if(s.isDisposed()||t.isDisposed())return!1;const e=s.getPosition(),i=t.getPosition(),n=s._width,r=e.getX(),o=t._width,g=i.getX();if(!(r<=g+o-1&&g<=r+n-1))return!1;const h=s._height,c=e.getY(),a=t._height,l=i.getY();return!!(c<=l+a-1&&l<=c+h-1)}(s,this)}enemyFriendly(s){return this._enemyFriendly=s,this}isEnemyFriendly(){return this._enemyFriendly}isProjectile(){return!0}move(){if(this.isDisposed())return;const s=this._dy,t=this._position.getY()+s;t<0||t>e-this._width?this.dispose():super.move(0,s)}},a=[[[" "," "," "," "," "," "," "," "," "," "],[" "," ","r","r","r","r","r","r"," "," "],[" ","r","r","r","r","r","r","r","r"," "],["r","r"," ","r","r","r","r"," ","r","r"],["r","r","r"," ","r","r"," ","r","r","r"],[" ","r","r","r","r","r","r","r","r"," "],["r"," "," "," ","r","r"," "," "," ","r"],[" ","r"," "," "," "," "," "," ","r"," "]],[[" "," "," "," "," "," "," "," "," "," "],[" "," ","r","r","r","r","r","r"," "," "],[" ","r","r","r","r","r","r","r","r"," "],["r","r"," ","r","r","r","r"," ","r","r"],["r","r","r"," ","r","r"," ","r","r","r"],[" ","r","r","r"," "," ","r","r","r"," "],[" ","r"," "," ","r","r"," "," ","r"," "],[" "," ","r"," "," "," "," ","r"," "," "]]],l=[[[" "," "," ","g","g","g","g"," "," "," "],[" "," ","g","g","g","g","g","g"," "," "],[" ","g","g"," ","g","g"," ","g","g"," "],["g","g","g","g","g","g","g","g","g","g"],[" ","g","g","g","g","g","g","g","g"," "],[" "," "," ","g"," "," ","g"," "," "," "],[" "," ","g","g"," "," ","g","g"," "," "],[" "," "," "," ","g","g"," "," "," "," "]],[[" "," "," ","g","g","g","g"," "," "," "],[" "," ","g","g","g","g","g","g"," "," "],[" ","g","g","g","g","g","g","g","g"," "],["g","g","g"," ","g","g"," ","g","g","g"],[" ","g","g","g","g","g","g","g","g"," "],[" "," "," ","g"," "," ","g"," "," "," "],[" "," "," ","g","g","g","g"," "," "," "],[" "," "," "," "," "," "," "," "," "," "]]],_=[[[" "," ","y"," "," "," "," ","y"," "," "],[" "," "," ","y"," "," ","y"," "," "," "],[" "," ","y","y","y","y","y","y"," "," "],[" ","y","y"," ","y","y"," ","y","y"," "],["y","y","y","y","y","y","y","y","y","y"],[" ","y","y","y","y","y","y","y","y"," "],[" "," ","y","y"," "," ","y","y"," "," "],[" "," ","y"," "," "," "," ","y"," "," "]],[[" "," "," ","y"," "," "," ","y"," "," "],[" "," "," ","y"," "," ","y"," "," "," "],[" "," ","y","y","y","y","y","y"," "," "],[" ","y","y"," ","y","y"," ","y","y"," "],["y","y","y","y","y","y","y","y","y","y"],[" ","y","y","y","y","y","y","y","y"," "],[" "," ","y","y"," "," ","y","y"," "," "],[" "," "," ","y"," "," ","y"," "," "," "]],[[" "," ","y"," "," "," ","y"," "," "," "],[" "," "," ","y"," "," ","y"," "," "," "],[" "," ","y","y","y","y","y","y"," "," "],[" ","y","y"," ","y","y"," ","y","y"," "],["y","y","y","y","y","y","y","y","y","y"],[" ","y","y","y","y","y","y","y","y"," "],[" "," ","y","y"," "," ","y","y"," "," "],[" "," ","y"," "," "," "," ","y"," "," "]]],d=[[[" ","v"," "],["v"," ","v"],[" ","v"," "]],[[" ","v"," "],["v","v","v"],[" ","v"," "]]],y=1,u=2,p=3,m=4,f=5,b=6,v=7,w=8,S=9;class x extends g{static TYPE={enemyOne:0,enemyTwo:1,enemyThree:2};static factory=function(s,t,e){switch(s){case x.TYPE.enemyOne:return new x(e,a,t,20);case x.TYPE.enemyTwo:return new x(e,l,t,30);case x.TYPE.enemyThree:return new x(e,_,t,50);default:return x.factory(TYPE.enemyOne,t,e)}};_points=0;_signals=null;constructor(s,t,e,i){super(t,e),this._points=i,this._signals=s}hitWith(s){s.isEnemyFriendly()||(this._signals.broadcast(w,this._points),this._signals.broadcast(m,this),s.dispose())}isEnemy(){return!0}shoot(){if(this.isDisposed())return;const s=this._position.getX()+this._width/2,t=this._position.getY()+this._height,e=new c(s,t,1,d).enemyFriendly(!0);this._signals.broadcast(v,e),this._signals.broadcast(S,"shoot")}}const k=x;function T(s,t=0){return t+Math.random()*(s-t)}const E=class{_gameObjects=[];_signals=null;constructor(s){this._signals=s,this._signals.subscribe(v,this.pushActor.bind(this))}dispose(){this._gameObjects.forEach((s=>s.dispose())),this._signals.clear([v]),this._gameObjects=[]}drawActors(s){for(const t of this._gameObjects)t.draw(s)}getActors(){return this._gameObjects}handleColisions(){const[s,t]=function(s){const t=[],e=[];for(const i of s)i.isProjectile?e.push(i):i.isGroup?t.push(...i.getActors()):t.push(i);return[t,e]}(this._gameObjects);for(const e of t){for(const t of s)e.colidesWith(t)&&t.hitWith(e);for(const s of t)s!==e&&s.colidesWith(e)&&(T(101,1)>=35?[e,s].forEach((s=>s.dispose())):e.isEnemyFriendly()?s.dispose():s.isEnemyFriendly()&&e.dispose())}}moveActors(){for(const s of this._gameObjects)s.isInMotion()&&s.move()}pushActor(s){this._gameObjects.push(s)}removeActor(s){this._gameObjects=this._gameObjects.filter((t=>t!==s))}removeDispatchedActors(){for(const s of this._gameObjects)s.isDisposed()&&this.removeActor(s)}},A=class{_disposed=!1;_format=null;_music=null;_path=null;_sound=null;_pathTo(s,t=this._format){if(s)return`${this._path}/${s}${t}`}_stop(s){s&&(s.pause(),s.currentTime=0)}constructor(s=".wav",t="./src/assets"){this._path=t,this._format=s}dispose(){this._disposed=!0,this._stop(this._music),this._stop(this._sound),this._music=null,this._sound=null}playMusic(s,t=!1){this._stop(this._music);const e=new Audio(this._pathTo(s));t&&e.addEventListener("ended",(()=>this.playMusic(s,!0))),this._music=e,this._music.play().then((()=>{this._disposed&&this._stop(e)}))}playMusicList(s,t=!0){let e=0;const i=()=>{const n=s[e++];n?(this.playMusic(n),this._music.addEventListener("ended",i)):t&&this.playMusicList(s,!0)};i()}playSound(s){this._stop(this._sound),this._sound=new Audio(this._pathTo(s)),this._sound.play()}},F={movePattern(s){let t=s._dx*s._speed,n=s._dy;const r=s._x+t;return s._lastX+t+10>i?(t=0,n+=9,s._dx=-1):r<=0&&(t=0,n+=9,s._dx=1),s._lastY+n+9>=e&&(t=0,n=0,s._signals.broadcast(S,"explosion"),s._signals.broadcast(f)),[t,n]}};function O(s){const t=s.getPosition();return[t.getX(),t.getY()]}const P=class{_dx=0;_dy=0;_gameObjects=[];_isDisposed=!1;_lastX=0;_lastY=0;_shootInterval;_signals=null;_sounds=null;_speed=0;_x=0;_y=0;constructor(s,{movementPatternMixin:t=F,initialDirection:e=1,initialSpeed:i=.1,initialX:n=0,initialY:r=0,shoot:o={every:1.5,probability:50}}={}){this._dx=e,this._signals=s,this._sounds=new A,this._speed=i,this._x=n,this._y=r,this._shootInterval=o&&this.initializeShooting(o.every,o.probability),this._signals.subscribe(m,this.dispatchActor.bind(this)),Object.assign(this,t)}dispatchActor(s){const t=s.getPosition(),e=t.getX(),i=t.getY(),{height:n,width:r}=s.getSize();s.dispose(),this.increaseSpeed(.02),this._signals.broadcast(S,"invaderkilled"),(e<=this._x||i<=this._y||e+r-1>=this._lastX||i+n-1>=this._lastY)&&this.resetGroupTotalSize(),1===this._gameObjects?.length&&(this._speed+=2,this._sounds.playMusic(["fastinvader1","fastinvader2","fastinvader3","fastinvader4"][Math.floor(T(4))],!0))}dispose(){clearInterval(this._shootInterval),this._sounds.dispose(),this._signals.clear([m]),this._gameObjects.forEach((s=>s.dispose())),this._gameObjects=[],this._isDisposed=!0}draw(s){this._gameObjects.forEach((t=>t.draw(s)))}getActors(){return this._gameObjects}increaseSpeed(s){this._speed+=s}initializeShooting(s,t){return setInterval((()=>{if(!(Math.floor(T(101,1))<=t))return;const s=Math.floor(T(this._gameObjects.length));this._gameObjects[s].shoot()}),1e3*s)}isDisposed(){return this._isDisposed}isInMotion(){return!0}isGroup(){return!0}move(){if(this.isDisposed())return;const[s,t]=this.movePattern(this);this._lastX+=s,this._lastY+=t,this._x+=s,this._y+=t;for(const e of this._gameObjects)e.move(s,t)}pushActor(s){this._gameObjects.push(s),this.updateGroupSize(s)}resetGroupTotalSize(){if(this._gameObjects=this._gameObjects.filter((s=>!s.isDisposed())),this._gameObjects.length<1)return this.dispose(),this._signals.broadcast(b);let s=0,t=0,e=this._lastX,i=this._lastY;for(const n of this._gameObjects){const[r,o]=O(n);r>s&&(s=r),o>t&&(t=o),r<e&&(e=r),o<i&&(i=o)}this._lastX=s,this._lastY=t,this._x=e,this._y=i}updateGroupSize(s){if(s.isDisposed())return;const[t,e]=O(s);t>this._lastX&&(this._lastX=t),e>this._lastY&&(this._lastY=e),t<this._x&&(this._x=t),e<this._y&&(this._y=e)}},D=class{_mappings={};_pressed={};constructor(s=!1){this.debug=s,window.addEventListener("keydown",this.keyPressed.bind(this)),window.addEventListener("keyup",this.keyReleased.bind(this))}bind(s,t){const e=Array.isArray(s)?s:[s];for(const s of e)this._mappings[s]=t}clear(){this._mappings={}}dispose(){window.removeEventListener("keydown",this.keyPressed.bind(this)),window.removeEventListener("keyup",this.keyReleased.bind(this)),this.clear()}keyPressed(s){const t=s.key,e=this._mappings[t];e&&(e(),this._pressed[t]=1),this.debug&&console.log(`${s.key} pressed.`)}keyReleased(s){const t=s.key;delete this._pressed[t]}reiteratePressed(){for(const s in this._pressed)this.keyPressed({key:s})}},I=class{constructor(s){const{callback:t,durationSec:e,text:i}=s;this.show(i),setTimeout((()=>this.hide(t)),1e3*e)}hide(s){document.getElementById("level-screen").remove(),s()}show(s){const e=document.createElement("div");e.id="level-screen",e.style.alignItems="center",e.style.background=t.bl,e.style.color=t.v,e.style.display="flex",e.style.fontFamily="Nosifier",e.style.fontSize="min(8vh,10vw)",e.style.height="100vh",e.style.justifyContent="center",e.style.left="0px",e.style.position="fixed",e.style.top="0px",e.style.width="100vw",e.style.zIndex=10,e.innerText=s,document.body.appendChild(e)}},j=[[[" "," "," "," "," "," ","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"," "," "," "," "," "," "],[" "," "," "," "," "," ","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"," "," "," "," "," "," "],[" "," "," "," "," "," ","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"," "," "," "," "," "," "],[" "," "," ","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"," "," "," "],[" "," "," ","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"," "," "," "],[" "," "," ","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"," "," "," "],["g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"],["g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"],["g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"],["g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g","g"],["g","g","g","g","g","g"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","g","g","g","g","g","g"],["g","g","g","g","g","g"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","g","g","g","g","g","g"],["g","g","g","g","g","g"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","g","g","g","g","g","g"],["g","g","g"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","g","g","g"],["g","g","g"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","g","g","g"],["g","g","g"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","g","g","g"]]],M=class extends g{constructor(s){var t;super((t=j,JSON.parse(JSON.stringify(t))),s)}hitWith(s){const t=function(s,t){const e=s,i=t,n=e.getSprite(),r=e.getPosition(),o=Math.round(r.getX()),g=Math.round(r.getY()),h=i.getSprite(),c=i.getPosition(),a=o-Math.round(c.getX()),l=g-Math.round(c.getY()),_=[];for(let s=0;s<n.length;s++){const t=n[s],i=s+l,r=h[i];if(r)for(let s=0;s<n[0].length;s++){const n=t[s];if(" "===e)continue;const o=s+a,g=r[o];g&&" "!==g&&n&&g&&_.push([i,o])}}if(_.length)return _}(s,this);if(t){const e=this._sprites[0];for(const[i,n]of t)e[i][n]&&(e[i][n]=" "),e[i+s._dy]&&(e[i+s._dy][n]=" ");s.dispose()}}isMound(){return!0}},z=class{_isDisposed=!1;_mounds=[];_signals=null;constructor(s){this._signals=s}dispose(){this._isDisposed=!0,this._mounds.forEach((s=>s.dispose()))}draw(s){this._mounds.forEach((t=>t.draw(s)))}getActors(){return this._mounds}isDisposed(){return this._isDisposed}isGroup(){return!0}isInMotion(){return!1}populate(){const s=Math.floor(28);let t=s;for(let e=0;e<4;e++)this.pushActor(new M(new o(t,148))),t+=30+s;return this}pushActor(s){this._mounds.push(s)}},Y=[[[" "," "," "," ","c","c"," "," "," "," "],[" ","c","c","c","c","c","c","c","c"," "],["c","c","c","c","c","c","c","c","c","c"],["c","c","c","c","c","c","c","c","c","c"]],[[" "," "," "," "," "," "," "," "," "," "],[" ","c","c","c","c","c","c","c","c"," "],["c","c","c","c","c","c","c","c","c","c"],["c","c","c","c","c","c","c","c","c","c"]]],C=class extends g{_blinking=!1;_blinkingFrame=0;_blinkingFrequency=15;_blinkingSprite=null;_blinkingTick=0;_lives=3;_loaded=!0;_signals=null;constructor(s){super(Y,new o(0,172)),this._isInMotion=!1,this._signals=s,s.subscribe(y,(()=>this.move(-1))),s.subscribe(u,(()=>this.move(1))),s.subscribe(p,this.shoot.bind(this))}addLife(){this._lives+=1}becomeInvunerable(s){this._blinking=!0,setTimeout((()=>{this._blinking=!1}),s)}canShoot(){return this._loaded}dispose(){this._projectile&&this._projectile.dispose(),this._signals.clear([y,u,p]),delete this._blinkingSprite,super.dispose()}getLivesDetails(){return[this._lives,this._sprites[0]]}getSprite(){const s=super.getSprite();return this._blinking&&(this._blinkingTick=(this._blinkingTick+1)%this._blinkingFrequency,0===this._blinkingTick&&(this._blinkingFrame=this._blinkingFrame?0:1),0===this._blinkingFrame)?(this._blinkingSprite=this._blinkingSprite||s.map((s=>s.map((s=>" ")))),this._blinkingSprite):s}hitWith(s){if(!this.isInvunerable()){if(this._lives-=1,this._signals.broadcast(S,"explosion"),this._lives<0)return this._signals.broadcast(f);this.becomeInvunerable(5e3),s.dispose()}}isInvunerable(){return this._blinking}isPlayer(){return!0}move(s){const t=this._position.getX()+s;t>=0&&t<=i-this._width&&super.move(s)}reload(){this.canShoot()||(this._loaded=!0)}shoot(){if(!this.canShoot())return;const s=this._position.getX()+this._width/2,t=this._position.getY()-4,e=new c(s,t,-1);this._signals.broadcast(v,e),this._signals.broadcast(S,"shoot"),this._loaded=!1,setTimeout(this.reload.bind(this),500)}};class L{_subscriptions={};constructor(){return L._instance?L._instance:L._instance=this}broadcast(s,t){const e=this._subscriptions[s]||[];for(const s of e)s(t)}clear(s){if(Array.isArray(s))for(const t of s)delete this._subscriptions[t];else this._subscriptions={}}subscribe(s,t){(this._subscriptions[s]||(this._subscriptions[s]=[])).push(t)}}const X=L,W=class{_highScore=null;constructor(s){const e=document.createElement("div");e.id="title-screen",e.style.alignItems="center",e.style.background="#121212",e.style.color="#fff",e.style.display="flex",e.style.flexDirection="column",e.style.gap="3vh",e.style.height="100vh",e.style.justifyContent="center",e.style.left=0,e.style.position="fixed",e.style.top=0,e.style.width="100vw";const i=document.createElement("h1");i.textContent="SPACE\n",i.style.color=t.v,i.style.fontFamily="Nosifier",i.style.fontSize="min(12vh,16vw)",i.style.fontWeight=900,i.style.lineHeight="1",i.style.marginBottom="0px",i.style.textAlign="center",i.style.whiteSpace="pre-line";const n=document.createElement("span");n.style.color=t.v,n.style.display="block",n.style.fontSize="min(8vh,12vw)",n.style.marginTop="-6px",n.innerText="INVADERS",i.appendChild(n);const r=document.createElement("button"),o="coral";r.style.background="#161616",r.style.border=`5px solid ${o}`,r.style.color=o,r.style.cursor="pointer",r.style.fontSize="18px",r.style.padding="20px",r.textContent="START GAME",r.addEventListener("click",s.start.bind(s)),e.appendChild(i),e.appendChild(r),document.body.appendChild(e)}hide(){document.getElementById("title-screen").style.display="none"}darken(){const s=document.getElementById("title-screen");s.style.display="flex",s.style.opacity="0.94"}},N=[[[" "," ","v","v","v","v","v","v"," "," "],[" ","v","v","v","v","v","v","v","v"," "],["v","v","v","v","v","v","v","v","v","v"],[" "," ","v","v","v","v","v","v"," "," "],[" "," "," ","v"," "," ","v"," "," "," "]]];class R extends g{static DIRECTION={leftToRight:1,rightToLeft:2};static SPEED={low:1,high:2};_dx=0;_points=0;_signals=null;_sounds=null;constructor(s,t,e){t=t||Object.values(R.DIRECTION)[Math.floor(T(2))],e=e||Object.values(R.SPEED)[Math.floor(T(2))];const i=t===R.DIRECTION.leftToRight?new o(0,5):new o(250,5);super(N,i),this._dx=t===R.DIRECTION.leftToRight?1:-1,this._points=1e3,this._signals=s,this._sounds=new A,this._sounds.playMusic(e===R.SPEED.high?"ufo_highpitch":"ufo_lowpitch",!0),this._speed=e===R.SPEED.high?1.8:.8}dispose(){this._sounds.dispose(),super.dispose()}hitWith(s){s.isEnemyFriendly()||(this._signals.broadcast(w,this._points),this._signals.broadcast(S,"invaderkilled"),s.dispose(),this.dispose())}isInMotion(){return!0}move(){const s=this._position.getX()+this._dx;if(s<0||s>250)return this.dispose();super.move(this._dx*this._speed)}}const B=R,G="js-space-invaders-score";new class{_canvas;_gameWorld;_hiScore;_inProgress;_keyboard;_lastFrame;_music;_player;_playerLastBonus;_score;_settings;_signals;_sound;_stage;_startTime;_titleScreen;_ufoTimeout;constructor(s){this._signals=new X,this._settings=s||this._settings,this._keyboard=new D,this._canvas=new n(this._settings.canvasId);const t=localStorage.getItem(G);this._hiScore=new r(t?parseInt(t):100),this._keyboard.bind(["a","A","ArrowLeft"],(()=>this._signals.broadcast(y))),this._keyboard.bind(["d","D","ArrowRight"],(()=>this._signals.broadcast(u))),this._keyboard.bind([" ","Enter"],(()=>this._signals.broadcast(p))),this._signals.subscribe(w,this.score.bind(this)),this._signals.subscribe(S,this.sound.bind(this)),this._signals.subscribe(f,this.end.bind(this)),this._signals.subscribe(b,this.nextStage.bind(this)),this._titleScreen=new W(this)}end(){this._inProgress=!1,clearTimeout(this._ufoTimeout),this._gameWorld.dispose(),this._music.playMusic("gameover"),this._titleScreen.darken();const s=this._score.getScore();s>this._hiScore.getScore()&&(this._hiScore.reset(s),localStorage.setItem(G,s))}nextStage(){this._stage.addScore(1),this.stage(this._stage.getScore())}randomlySpawnNextUfo(){const s=T(2.5,.3);this._ufoTimeout=setTimeout((()=>{this._gameWorld.pushActor(new B(this._signals)),this.randomlySpawnNextUfo()}),6e4*s)}requestNextTick(){requestAnimationFrame(this.tick.bind(this))}score(s){this._score.addScore(s);const t=this._score.getScore();1e-4*(t-this._playerLastBonus)>=1&&(this._player.addLife(),this._playerLastBonus=t)}sound(s){this._sound.playSound(s)}stage(s){this._inProgress=!1,clearTimeout(this._ufoTimeout),s=s||this._stage.getScore();const t=Math.floor(18.571428571428573)-5,e=Math.min(3+s,t),i=Math.floor(s/12),n=new P(this._signals,{initialSpeed:.1*s,shoot:{every:1.5+.1*s,probability:50+2*s}});for(let s=0;s<e;s++){n.pushActor(k.factory(k.TYPE.enemyThree,new o(14*s,12),this._signals)),n.pushActor(k.factory(k.TYPE.enemyTwo,new o(14*s,22),this._signals)),n.pushActor(k.factory(k.TYPE.enemyOne,new o(14*s,32),this._signals)),n.pushActor(k.factory(k.TYPE.enemyOne,new o(14*s,42),this._signals));for(let t=0;t<i;t++)n.pushActor(k.factory(k.TYPE.enemyOne,new o(14*s,12+10*(4+t)),this._signals))}this._gameWorld.pushActor(n),new I({callback:()=>{this._inProgress=!0,this.requestNextTick()},durationSec:1,text:`STAGE ${s}`}),this.randomlySpawnNextUfo()}start(){this._titleScreen.hide(),this._inProgress=!0,this._player=new C(this._signals),this._gameWorld=new E(this._signals),this._gameWorld.pushActor(this._player);const s=new z(this._signals);this._gameWorld.pushActor(s.populate(4)),this._music=new A(".mp3"),this._music.playMusicList(["music"]),this._score=new r(0),this._sound=new A(".wav"),this._stage=new r(1),this.stage(this._stage.getScore()),this.requestNextTick()}tick(s){if(!this._inProgress)return;void 0===this._startTime&&(this._startTime=s);const t=s-this._startTime,e=Math.round(t/(1e3/this._settings.fps))%this._settings.fps;e!==this._lastFrame&&(this._canvas.clear(),this._canvas.drawScore(this._stage.getScore(),this._hiScore.getScore(),this._score.getScore()),this._canvas.drawLives(this._player.getLivesDetails()),this._gameWorld.moveActors(),this._gameWorld.drawActors(this._canvas),this._gameWorld.handleColisions(),this._gameWorld.removeDispatchedActors(),this._keyboard.reiteratePressed(),this._lastFrame=e),this.requestNextTick()}}({canvasId:"canvas",fps:60})})();